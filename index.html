<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visor de recursos</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ol3/3.20.1/ol.css" />
  <style>
    /* Estilos generales */
    body, html {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }
    #header {
      background-color: #2c3e50;
      color: white;
      text-align: center;
      padding: 10px 0;
      font-size: 1.5em;
    }
    #map {
      width: 100%;
      height: 70vh;
    }
    /* Estilos del formulario */
    .form-popup {
      display: none;
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translate(-50%, -20%);
      border: 2px solid #ddd;
      padding: 20px;
      background-color: white;
      z-index: 10;
      width: 80%;
      max-width: 500px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      border-radius: 10px;
    }
    .form-popup h3 {
      margin-top: 0;
    }
    .form-popup label {
      display: block;
      margin: 10px 0 5px;
    }
    .form-popup input, .form-popup select, .form-popup textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .form-popup button {
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .form-popup .btn-close {
      background-color: #e74c3c;
      color: white;
    }
    .form-popup .btn-submit {
      background-color: #2ecc71;
      color: white;
    }
    #reportButton {
      position: fixed;
      top: 10px;
      right: 10px;
      padding: 10px 15px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <div id="header">Visor de recursos para gestión de emergencias</div>
  <button id="reportButton">Reportar Emergencia</button>
  <div id="map"></div>

  <!-- Formulario Emergente -->
  <div class="form-popup" id="reportForm">
    <h3>Formulario de Reporte de Emergencia</h3>

    <label>Estado del Incendio</label>
    <select id="estadoIncendio">
      <option value="Activo">Activo</option>
      <option value="Sin avance">Sin avance</option>
    </select>

    <label>Superficie Preliminar (ha)</label>
    <input type="number" id="superficiePreliminar" required>

    <label>Recurso Primer Ataque</label>
    <select id="recursoAtaque">
      <option value="Unidad 1">Unidad 1</option>
      <option value="Unidad 2">Unidad 2</option>
      <!-- Agrega más unidades según sea necesario -->
    </select>

    <label>Comandante de Incidente</label>
    <select id="comandanteIncidente">
      <option value="Comandante 1">Comandante 1</option>
      <option value="Comandante 2">Comandante 2</option>
      <!-- Agrega más nombres de comandantes -->
    </select>

    <label>Lugar del Incidente</label>
    <select id="lugarIncidente">
      <option value="Sector 1">Sector 1</option>
      <option value="Sector 2">Sector 2</option>
      <!-- Agrega más opciones de lugares -->
    </select>

    <label>Coordenadas Operativas (capturadas automáticamente)</label>
    <input type="text" id="coordenadasOperativas" readonly>

    <label>Solicitud de Recursos</label>
    <select id="solicitudRecursos" multiple>
      <option value="Helicóptero">Helicóptero</option>
      <option value="Brigada">Brigada</option>
      <option value="Técnico">Técnico</option>
      <option value="Aljibe">Aljibe</option>
      <option value="Saesa">Saesa</option>
      <option value="Bomberos">Bomberos</option>
    </select>

    <label>Amenaza a</label>
    <select id="amenaza" multiple>
      <option value="Casas">Casas</option>
      <option value="Bosque Nativo">Bosque Nativo</option>
      <option value="APR">APR</option>
    </select>

    <label>Combustible Afectado al Arribo</label>
    <select id="combustible" multiple>
      <option value="Espinillo">Espinillo</option>
      <option value="Bosque Nativo">Bosque Nativo</option>
      <option value="Pastizal">Pastizal</option>
    </select>

    <label>Comportamiento General del Incendio</label>
    <div>
      <label>Propagación</label>
      <select class="comportamiento">
        <option value="Lento">Lento</option>
        <option value="Moderado">Moderado</option>
        <option value="Rápido">Rápido</option>
      </select>

      <label>Intensidad</label>
      <select class="comportamiento">
        <option value="Baja">Baja</option>
        <option value="Moderada">Moderada</option>
        <option value="Alta">Alta</option>
      </select>

      <label>Dirección</label>
      <select class="comportamiento">
        <option value="Norte">Norte</option>
        <option value="Sur">Sur</option>
        <option value="Este">Este</option>
        <option value="Oeste">Oeste</option>
      </select>
    </div>

    <button class="btn-submit" onclick="enviarReporte()">Enviar Reporte a WhatsApp</button>
    <button class="btn-close" onclick="cerrarFormulario()">Cerrar</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/ol3/3.20.1/ol.js"></script>
  <script>
    // Mapa y marcador de usuario
    const map = new ol.Map({
      target: 'map',
      layers: [
        new ol.layer.Tile({
          source: new ol.source.OSM()
        })
      ],
      view: new ol.View({
        center: ol.proj.fromLonLat([-73.7669, -42.4804]),
        zoom: 8
      })
    });

    let userCoordinates;

    function localizar() {
      if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(position => {
          userCoordinates = [position.coords.longitude, position.coords.latitude];
          const coordProj = ol.proj.fromLonLat(userCoordinates);
          document.getElementById('coordenadasOperativas').value = `Lat: ${userCoordinates[1]}, Lon: ${userCoordinates[0]}`;
          map.getView().animate({ center: coordProj, zoom: 12 });
        }, error => {
          alert("No se pudo obtener la ubicación.");
        });
      } else {
        alert("Geolocalización no está soportada.");
      }
    }
    localizar();

    // Mostrar y ocultar formulario
    document.getElementById('reportButton').onclick = () => {
      document.getElementById('reportForm').style.display = 'block';
    };
    function cerrarFormulario() {
      document.getElementById('reportForm').style.display = 'none';
    }

    // Enviar reporte a WhatsApp
    function enviarReporte() {
      const estadoIncendio = document.getElementById('estadoIncendio').value;
      const superficiePreliminar = document.getElementById('superficiePreliminar').value;
      const recursoAtaque = document.getElementById('recursoAtaque').value;
      const comandanteIncidente = document.getElementById('comandanteIncidente').value;
      const lugarIncidente = document.getElementById('lugarIncidente').value;
      const coordenadasOperativas = document.getElementById('coordenadasOperativas').value;

      const solicitudRecursos = Array.from(document.getElementById('solicitudRecursos').selectedOptions)
          .map(option => option.value).join(", ");
      const amenaza = Array.from(document.getElementById('amenaza').selectedOptions)
          .map(option => option.value).join(", ");
      const combustible = Array.from(document.getElementById('combustible').selectedOptions)
          .map(option => option.value).join(", ");

      const comportamientoList = document.querySelectorAll(".comportamiento");
      const comportamiento = Array.from(comportamientoList).map(select => select.value).join(", ");

      // Crear mensaje para WhatsApp
      const mensaje = `*Reporte de Emergencia*\n` +
          `Estado del Incendio: ${estadoIncendio}\n` +
          `Superficie Preliminar: ${superficiePreliminar} ha\n` +
          `Recurso Primer Ataque: ${recursoAtaque}\n` +
          `Comandante de Incidente: ${comandanteIncidente}\n` +
          `Lugar del Incidente: ${lugarIncidente}\n` +
          `Coordenadas: ${coordenadasOperativas}\n` +
          `Solicitud de Recursos: ${solicitudRecursos}\n` +
          `Amenaza a: ${amenaza}\n` +
          `Combustible Afectado al Arribo: ${combustible}\n` +
          `Comportamiento General: ${comportamiento}`;

      const whatsappURL = `https://wa.me/?text=${encodeURIComponent(mensaje)}`;
      window.open(whatsappURL, '_blank');
    }
  </script>
</body>
</html>
